@model ProjectManagementSystem.DBModels.Project

@{
    ViewData["Title"] = "Project Details";
    Layout = "_Layout";
}

<style>
    body {
        background: linear-gradient(135deg, #e4eefd);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .custom-details-card {
        max-width: 900px;
        margin: 0 auto;
        border-radius: 16px;
    }

    .custom-card-header {
        background-color: #8c5dd1;
        color: white;
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
        padding: 16px;
    }

    .custom-table th {
        width: 30%;
        background-color: #f8f9fa;
        vertical-align: middle;
    }

    .custom-table td {
        background-color: #fff;
    }

    .company-card {
        border: 1px solid #dee2e6;
        border-radius: 12px;
        overflow: hidden;
        margin-top: 20px;
    }

    .company-image {
        width: 100%;
        max-height: 200px;
        object-fit: cover;
    }

    .back-button {
        margin-top: 20px;
    }
</style>

<div class="card custom-details-card shadow">
    <div class="custom-card-header">
        <h4 class="mb-0">📘 Project Details</h4>
    </div>
    <div class="card-body p-4">
        <table class="table table-bordered custom-table">
            <tr>
                <th>Project Name</th>
                <td>@Model.ProjectName</td>
            </tr>
            <tr>
                <th>Supervisor</th>
                <td>@Model.SupervisorName</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>@Model.Description</td>
            </tr>
            <tr>
                <th>Project Type</th>
                <td>@Model.ProjectTypePk?.TypeName</td>
            </tr>
            <tr>
                <th>Language</th>
                <td>@Model.LanguagePk?.LanguageName</td>
            </tr>
            <tr>
                <th>Framework</th>
                <td>@Model.FrameworkPk?.FrameworkName</td>
            </tr>
            <tr>
                <th>Company</th>
                <td>@Model.CompanyPk?.CompanyName</td>
            </tr>

            <tr>
                <th>Leader</th>
                <td>
                    @{
                        var leader = Model.ProjectMembers?
                        .FirstOrDefault(pm => pm.Role == "Leader" && pm.IsDeleted==false && pm.StudentPk != null);
                        if (leader != null)
                        {
                            <span>@leader.StudentPk.StudentName </span>
                        }
                        else
                        {
                            <span class="text-muted">No leader assigned</span>
                        }
                    }
                </td>
            </tr>

            <tr>
                <th>Members</th>
                <td>
                    @{
                        var members = Model.ProjectMembers?
                        .Where(pm => pm.Role == "Member" && pm.IsDeleted==false && pm.StudentPk != null)
                        .ToList();
                        if (members != null && members.Any())
                        {
                            foreach (var member in members)
                            {
                                <div>@member.StudentPk.StudentName</div>
                            }
                        }
                        else
                        {
                            <span class="text-muted">No members assigned</span>
                        }
                    }
                </td>
            </tr>


            <tr>
                <th>Status</th>
                <td>@Model.Status</td>
            </tr>
            <tr>
                <th>Submitted Date</th>
                <td> @(Model.ProjectSubmittedDate.HasValue ? Model.ProjectSubmittedDate.Value.ToShortDateString() : "Not submitted")
                </td>
            </tr>

            <tr>
                <th>Created By</th>
                <td>@Model.CreatedBy</td>
            </tr>

            <tr>
                <th>Status</th>
                <td>
                    @switch (Model.Status)
                    {
                        case "Approved":
                            <span class="badge bg-success">Approved</span>
                            break;
                        case "Rejected":
                            <span class="badge bg-danger">Rejected</span>
                            break;
                        case "Pending":
                            <span class="badge bg-warning text-dark">Pending</span>
                            break;
                        default:
                            <span class="badge bg-secondary">@Model.Status</span>
                            break;
                    }
                </td>
            </tr>


        </table>
        @if (Model.Status == "Rejected" && !string.IsNullOrWhiteSpace(Model.AdminComment))
        {
            <div class="alert alert-danger mt-4">
                <strong>Rejection Reason:</strong> @Model.AdminComment
            </div>
        }

        @if (Model.CompanyPk != null)
        {
            <div class="company-card mt-4">
                @if (!string.IsNullOrEmpty(Model.CompanyPk.ImageFileName))
                {
                    <img class="company-image" src="~/images/companies/@Model.CompanyPk.ImageFileName" alt="Company Image" />
                }
                <div class="p-3">
                    <h5>@Model.CompanyPk.CompanyName</h5>
                    <p><strong>Address:</strong> @Model.CompanyPk.Address</p>
                    <p><strong>Contact:</strong> @Model.CompanyPk.Contact</p>
                    <p><strong>Description:</strong> @Model.CompanyPk.Description</p>
                    <p><strong>City:</strong> @Model.CompanyPk.CityPk?.CityName</p>
                </div>
            </div>
        }

        @if (Model.ProjectFiles != null && Model.ProjectFiles.Any())
        {
            <hr />
            <h5 class="mt-4">📎 Project Files</h5>
            <ul class="list-group">
                @foreach (var file in Model.ProjectFiles)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="@file.FilePath" target="_blank">Download @file.FileType file</a>
                    </li>
                }
            </ul>
        }

        <div class="back-button text-end">
            <a asp-action="Index" class="btn btn-secondary">⬅ Back to List</a>
        </div>
    </div>
</div>
